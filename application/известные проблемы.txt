// этот метод вызывается из gRPC
// в шлюзе в методе, ответственном за создание записи товара, также генерируется само имя папки,
// которое передается в дальнейших запросах к этому сервису
func (a *App) InitialSave(service, productDirName string, img []byte) error { // типа tmp/service/dir/id.jpg
	// каждая загружаемая фотография сначала должна увеличивать счетчик в кэше

	// сначала проверить количество и сохранить, потом инкрементировать
	// хотя лучше сначала проверить, потом инкрементировать, а в случае ошибки декрементировать и сохранить на диск

	// так как между созданием товара и обработкой с сохранением на диск изображений есть время, за которое можно отправить миллиард фотографий
	// по команде добавления новых фоток, то надо проверять количество запросов! сумму количества запросов и изображений на диске
	// видимо, эту сумму придется хранить в кэше, чтобы шлюз тоже имел доступ к этой информации
	// и ходить при каждом запросе в БД - то ещё расточительство, организую новую мапу в памяти
	a.SC.ReqCount[dir]++

	// тут будет проверка на количество фоток в директории, эта же проверка должна быть и в таблице, связанной с товаром
	// и не позволит отправить ещё фотографии уже в шлюзе
}

Я НЕ СДЕЛАЛ КЭШ ДЛЯ ЭТОГО
А ОН И НЕ НУЖЕН - КАК ШЛЮЗ ДОЛЖЕН САМ ОБНОВЛЯТЬ ЗНАЧЕНИЯ КЭША?? НА КОРОТКОЙ ДИСТАНЦИИ МОЖЕТ БЫТЬ ТОЛЬКО ПОЛЕЗЕН
НЕ НАДО ПОКА НА КЭШ

ВСЁ РЕШИЛ - ПРОСТО НЕЛЬЗЯ ВЫЗВАТЬ МЕТОДЫ ДОБАВЛЕНИЯ ФОТОГРАФИЙ, ПОКА ФОТОГРАФИИ ОБРАБАТЫВАЮТСЯ